{
    "collab_server" : "",
    "contents" : "library(rvest)\nlibrary(tidyverse)\nlibrary(stringr)\nlibrary(curl)\n\n\nurl <- read_html(\"http://plebiscito.registraduria.gov.co/99PL/DPLZZZZZZZZZZZZZZZZZ_L1.htm\")\nurls_depto <- url %>% html_nodes('#combo2 > option') %>% html_attr(\"value\")\nnames_depto <- url %>% html_nodes('#combo2 > option') %>% html_text()\n\nurls_depto <- urls_depto[-1]\nnames_depto <- names_depto[-1]\nurls_depto <- gsub(\"\\\\.\\\\.\", \"http://plebiscito.registraduria.gov.co\", urls_depto)\nurls_depto[1]\nlist_df_depto <- lapply(urls_depto, function(url_depto){\n  \n  h <- read_html(url_depto)\n  urls_mpio <- h %>% html_nodes(\"#combo3 > option\") %>% html_attr(\"value\")\n  names_mpio <- h %>% html_nodes('#combo3 > option') %>% html_text()\n  \n  urls_mpio <- urls_mpio[-1]\n  names_mpio <- names_mpio[-1]\n  \n  urls_mpio <- gsub(\"\\\\.\\\\.\", \"http://plebiscito.registraduria.gov.co\", urls_mpio)\n  name_depto <- names_depto[which(urls_depto==url_depto)]\n  df <- data.frame(Names_mpio = names_mpio, \n                   Names_depto = name_depto,\n                   URL_mpio = urls_mpio,\n                   URL_depto = url_depto)\n  gc()\n  return(df)\n  \n})\n\ndf <- bind_rows(list_df)\n\nurls_mpio <- df$URL_mpio\nlist_df <- lapply(urls_mpio, function(url_mpio){\n  \n  h <- read_html(url_mpio)\n  info_votos <- h %>% html_nodes(\".skill-bar-percent, .contenido, .cajaDatosBody span\") %>%\n    html_text()\n  info_votos <- gsub(\"Votos válidos|Votos no marcados|Votos nulos| mesas instaladas| personas habilitadas\", \n                     \"\", info_votos)\n  df <- data.frame(t(info_votos))\n  names(df) <- c(\"Porc_escrutado\", \"Mesas_instaladas\", \"Votacion\", \n                 \"Votos/Personas_habilitadas\", \"Porc_SI\", \"Votos_SI\", \n                 \"Porc_NO\",\"Votos_NO\", \"Votos_Válidos\",\n                 \"Votos_no_marcados\", \"Votos_nulos\")\n  gc()\n  return(df)\n})\n\ndf_info <- bind_rows(list_df)  \n\npleb <- bind_cols(list(df,df_info))\npleb$Votos_SI <- gsub(\"\\\\(|\\\\)| Votos|\\\\.\",\"\",pleb$Votos_SI)\npleb$Votos_NO <- gsub(\"\\\\(|\\\\)| Votos|\\\\.\",\"\",pleb$Votos_NO)\npleb$Porc_escrutado <- gsub(\"\\\\%\",\"\",pleb$Porc_escrutado)\npleb$Porc_escrutado <- gsub(\"\\\\,\",\"\\\\.\", pleb$Porc_escrutado)\npleb$Votacion <- gsub(\"\\\\%\",\"\", pleb$Votacion)\npleb$Votacion <- gsub(\"\\\\,\",\"\\\\.\", pleb$Votacion)\npleb$Porc_SI <- gsub(\"\\\\%\",\"\", pleb$Porc_SI)\npleb$Porc_SI <- gsub(\"\\\\,\",\"\\\\.\", pleb$Porc_SI)\npleb$Porc_NO <- gsub(\"\\\\%\",\"\", pleb$Porc_NO)\npleb$Porc_NO <- gsub(\"\\\\,\",\"\\\\.\", pleb$Porc_NO)\npleb$`Votos/Personas_habilitadas` <- gsub(\"\\\\.\",\"\", pleb$`Votos/Personas_habilitadas`)\npleb$Mesas_instaladas <-gsub(\"\\\\.\",\"\", pleb$Mesas_instaladas)\npleb$Votos_Válidos <- gsub(\"\\\\.\",\"\", pleb$Votos_Válidos)\npleb$Votos_no_marcados <- gsub(\"\\\\.\",\"\", pleb$Votos_no_marcados)\npleb$Votos_nulos <- gsub(\"Votos nulos|\\\\.\",\"\", pleb$Votos_nulos)\npleb <- pleb %>% separate(`Votos/Personas_habilitadas`, c(\"Num_Votos\", \"Num_Personas_Habilitadas\"), sep=\" de \")\npleb <- pleb %>% separate(Mesas_instaladas, c(\"Num_mesas\", \"Total_mesas\"), sep=\" de \")\npleb[,c(-1,-2,-3,-4)] <- sapply(pleb[,c(-1,-2,-3,-4)], as.numeric)\npleb <- pleb %>% dplyr::mutate(Porc_Mesas_Inscritas = Num_mesas / Total_mesas,\n                               Porc_Abstensionismo = 1-(Num_Votos/Num_Personas_Habilitadas))\n\nwrite_csv(pleb, \"data/votacion_plebiscito_2016_mpios.csv\", col_names = TRUE)\n\n######################################################\n\n\nurl <- read_html(\"http://plebiscito.registraduria.gov.co/99PL/DPLZZZZZZZZZZZZZZZZZ_L1.htm\")\nurls_depto <- url %>% html_nodes('#combo2 > option') %>% html_attr(\"value\")\nnames_depto <- url %>% html_nodes('#combo2 > option') %>% html_text()\nurls_depto <- gsub(\"\\\\.\\\\.\", \"http://plebiscito.registraduria.gov.co\", urls_depto)\n\nlist_df_depto <- lapply(urls_depto, function(url_depto){\n  h <- read_html(url_depto)\n  info_votos <- h %>% html_nodes(\".skill-bar-percent , .contenido , .descripcionCaja , .porcentajesCajas\") %>%\n    html_text()\n  info_votos <- gsub(\" mesas instaladas|\\\\%|Votos válidos|Votos nulos| personas habilitadas |Votos no marcados\",\n                     \"\", info_votos)\n  info_votos <- gsub(\"\\\\.|\\\\(|\\\\)| Votos\",\"\", info_votos)\n  info_votos <- gsub(\"\\\\,\",\"\\\\.\", info_votos)\n  name_depto <- names_depto[which(urls_depto==url_depto)]\n  df <- data.frame(Names_depto = name_depto,\n                   URL_depto = url_depto)\n  df_info <- data.frame(t(info_votos))\n  names(df_info) <- c(\"Porc_escrutado\", \"Mesas_instaladas\", \"Votacion\", \n                 \"Votos/Personas_habilitadas\", \"Porc_SI\", \"Votos_SI\", \n                 \"Porc_NO\",\"Votos_NO\", \"Votos_Válidos\",\n                 \"Votos_no_marcados\", \"Votos_nulos\")\n  df <- bind_cols(list(df, df_info))\n  \n  gc()\n  return(df)\n})\n\ndf_depto <- bind_rows(list_df_depto)\ndf_depto <- df_depto %>% separate(`Votos/Personas_habilitadas`, c(\"Num_Votos\", \"Num_Personas_Habilitadas\"), sep=\" de \")\ndf_depto <- df_depto %>% separate(Mesas_instaladas, c(\"Num_mesas\", \"Total_mesas\"), sep=\" de \")\ndf_depto[,c(-1,-2)] <- sapply(df_depto[,c(-1,-2)], as.numeric)\ndf_depto <- df_depto %>% dplyr::mutate(Porc_Mesas_Inscritas = Num_mesas / Total_mesas,\n                               Porc_Abstensionismo = 1-(Num_Votos/Num_Personas_Habilitadas))\n\n\nwrite_csv(df_depto, \"data/votacion_plebiscito_2016_deptos.csv\", col_names = TRUE)\n",
    "created" : 1510514497204.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3268041469",
    "id" : "773CFB90",
    "lastKnownWriteTime" : 1475594944,
    "last_content_update" : 1475594944,
    "path" : "C:/Users/natalia.raffo/Desktop/datos_plebiscito/plebiscito.R",
    "project_path" : "plebiscito.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}